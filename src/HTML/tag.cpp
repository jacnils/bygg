/*
 * bygg - Component-based HTML/CSS builder for C++
 *
 * Copyright 2024 - Jacob Nilsson & contributors
 * SPDX-License-Identifier: MIT
 */

#include <bygg/except.hpp>
#include <bygg/HTML/tag.hpp>
#include <algorithm>

std::unordered_map<bygg::HTML::Tag, std::pair<bygg::string_type, bygg::HTML::Type>> bygg::HTML::get_tag_map() {
    return {
        {Tag::Empty, {"", Type::Text}},
        {Tag::Empty_No_Formatting, {"", Type::Text_No_Formatting}},
        {Tag::Abbreviation, {"abbr", Type::Non_Self_Closing}},
        {Tag::Abbr, {"abbr", Type::Non_Self_Closing}},
        {Tag::Acronym, {"acronym", Type::Non_Self_Closing}},
        {Tag::Address, {"address", Type::Non_Self_Closing}},
        {Tag::Applet, {"applet", Type::Non_Self_Closing}},
        {Tag::Anchor, {"a", Type::Non_Self_Closing}},
        {Tag::A, {"a", Type::Non_Self_Closing}},
        {Tag::Article, {"article", Type::Non_Self_Closing}},
        {Tag::Area, {"area", Type::Self_Closing}},
        {Tag::Aside, {"aside", Type::Non_Self_Closing}},
        {Tag::Audio, {"audio", Type::Non_Self_Closing}},
        {Tag::Base, {"base", Type::Self_Closing}},
        {Tag::Basefont, {"basefont", Type::Self_Closing}},
        {Tag::Bdi, {"bdi", Type::Non_Self_Closing}},
        {Tag::Bdo, {"bdo", Type::Non_Self_Closing}},
        {Tag::Bgsound, {"bgsound", Type::Non_Self_Closing}},
        {Tag::Big, {"big", Type::Non_Self_Closing}},
        {Tag::Blockquote, {"blockquote", Type::Non_Self_Closing}},
        {Tag::Body, {"body", Type::Non_Self_Closing}},
        {Tag::B, {"b", Type::Non_Self_Closing}},
        {Tag::Bold, {"b", Type::Non_Self_Closing}},
        {Tag::Br, {"br", Type::Self_Closing}},
        {Tag::Break, {"br", Type::Self_Closing}},
        {Tag::Button, {"button", Type::Non_Self_Closing}},
        {Tag::Caption, {"caption", Type::Non_Self_Closing}},
        {Tag::Canvas, {"canvas", Type::Non_Self_Closing}},
        {Tag::Center, {"center", Type::Non_Self_Closing}},
        {Tag::Cite, {"cite", Type::Non_Self_Closing}},
        {Tag::Code, {"code", Type::Non_Self_Closing}},
        {Tag::Colgroup, {"colgroup", Type::Non_Self_Closing}},
        {Tag::Column, {"col", Type::Self_Closing}},
        {Tag::Col, {"col", Type::Self_Closing}},
        {Tag::Data, {"data", Type::Non_Self_Closing}},
        {Tag::Datalist, {"datalist", Type::Non_Self_Closing}},
        {Tag::Dd, {"dd", Type::Non_Self_Closing}},
        {Tag::Dfn, {"dfn", Type::Non_Self_Closing}},
        {Tag::Define, {"dfn", Type::Non_Self_Closing}},
        {Tag::Delete, {"del", Type::Non_Self_Closing}},
        {Tag::Del, {"del", Type::Non_Self_Closing}},
        {Tag::Details, {"details", Type::Non_Self_Closing}},
        {Tag::Dialog, {"dialog", Type::Non_Self_Closing}},
        {Tag::Dir, {"dir", Type::Non_Self_Closing}},
        {Tag::Div, {"div", Type::Non_Self_Closing}},
        {Tag::Dl, {"dl", Type::Non_Self_Closing}},
        {Tag::Dt, {"dt", Type::Non_Self_Closing}},
        {Tag::Embed, {"embed", Type::Self_Closing}},
        {Tag::Emphasis, {"em", Type::Non_Self_Closing}},
        {Tag::Em, {"em", Type::Non_Self_Closing}},
        {Tag::Fieldset, {"fieldset", Type::Non_Self_Closing}},
        {Tag::Figcaption, {"figcaption", Type::Non_Self_Closing}},
        {Tag::Figure, {"figure", Type::Non_Self_Closing}},
        {Tag::Font, {"font", Type::Non_Self_Closing}},
        {Tag::Footer, {"footer", Type::Non_Self_Closing}},
        {Tag::Form, {"form", Type::Non_Self_Closing}},
        {Tag::Frame, {"frame", Type::Self_Closing}},
        {Tag::Frameset, {"frameset", Type::Non_Self_Closing}},
        {Tag::Head, {"head", Type::Non_Self_Closing}},
        {Tag::Header, {"header", Type::Non_Self_Closing}},
        {Tag::H1, {"h1", Type::Non_Self_Closing}},
        {Tag::H2, {"h2", Type::Non_Self_Closing}},
        {Tag::H3, {"h3", Type::Non_Self_Closing}},
        {Tag::H4, {"h4", Type::Non_Self_Closing}},
        {Tag::H5, {"h5", Type::Non_Self_Closing}},
        {Tag::H6, {"h6", Type::Non_Self_Closing}},
        {Tag::Hr, {"hr", Type::Self_Closing}},
        {Tag::Hgroup, {"hgroup", Type::Non_Self_Closing}},
        {Tag::Html, {"html", Type::Non_Self_Closing}},
        {Tag::Iframe, {"iframe", Type::Non_Self_Closing}},
        {Tag::Image, {"img", Type::Self_Closing}},
        {Tag::Img, {"img", Type::Self_Closing}},
        {Tag::Input, {"input", Type::Self_Closing}},
        {Tag::Ins, {"ins", Type::Non_Self_Closing}},
        {Tag::Isindex, {"isindex", Type::Self_Closing}},
        {Tag::Italic, {"i", Type::Non_Self_Closing}},
        {Tag::I, {"i", Type::Non_Self_Closing}},
        {Tag::Kbd, {"kbd", Type::Non_Self_Closing}},
        {Tag::Keygen, {"keygen", Type::Self_Closing}},
        {Tag::Label, {"label", Type::Non_Self_Closing}},
        {Tag::Legend, {"legend", Type::Non_Self_Closing}},
        {Tag::List, {"li", Type::Non_Self_Closing}},
        {Tag::Li, {"li", Type::Non_Self_Closing}},
        {Tag::Link, {"link", Type::Self_Closing}},
        {Tag::Main, {"main", Type::Non_Self_Closing}},
        {Tag::Mark, {"mark", Type::Non_Self_Closing}},
        {Tag::Marquee, {"marquee", Type::Non_Self_Closing}},
        {Tag::Menuitem, {"menuitem", Type::Non_Self_Closing}},
        {Tag::Meta, {"meta", Type::Self_Closing}},
        {Tag::Meter, {"meter", Type::Non_Self_Closing}},
        {Tag::Nav, {"nav", Type::Non_Self_Closing}},
        {Tag::Nobreak, {"nobr", Type::Non_Self_Closing}},
        {Tag::Nobr, {"nobr", Type::Non_Self_Closing}},
        {Tag::Noembed, {"noembed", Type::Non_Self_Closing}},
        {Tag::Noscript, {"noscript", Type::Non_Self_Closing}},
        {Tag::Object, {"object", Type::Non_Self_Closing}},
        {Tag::Optgroup, {"optgroup", Type::Non_Self_Closing}},
        {Tag::Option, {"option", Type::Non_Self_Closing}},
        {Tag::Output, {"output", Type::Non_Self_Closing}},
        {Tag::Paragraph, {"p", Type::Non_Self_Closing}},
        {Tag::P, {"p", Type::Non_Self_Closing}},
        {Tag::Param, {"param", Type::Self_Closing}},
        {Tag::Phrase, {"phrase", Type::Non_Self_Closing}},
        {Tag::Pre, {"pre", Type::Non_Self_Closing}},
        {Tag::Progress, {"progress", Type::Non_Self_Closing}},
        {Tag::Quote, {"q", Type::Non_Self_Closing}},
        {Tag::Q, {"q", Type::Non_Self_Closing}},
        {Tag::Rp, {"rp", Type::Non_Self_Closing}},
        {Tag::Rt, {"rt", Type::Non_Self_Closing}},
        {Tag::Ruby, {"ruby", Type::Non_Self_Closing}},
        {Tag::Outdated, {"s", Type::Non_Self_Closing}},
        {Tag::S, {"s", Type::Non_Self_Closing}},
        {Tag::Sample, {"samp", Type::Non_Self_Closing}},
        {Tag::Samp, {"samp", Type::Non_Self_Closing}},
        {Tag::Script, {"script", Type::Non_Self_Closing}},
        {Tag::Section, {"section", Type::Non_Self_Closing}},
        {Tag::Small, {"small", Type::Non_Self_Closing}},
        {Tag::Source, {"source", Type::Non_Self_Closing}},
        {Tag::Spacer, {"spacer", Type::Non_Self_Closing}},
        {Tag::Span, {"span", Type::Non_Self_Closing}},
        {Tag::Strike, {"strike", Type::Non_Self_Closing}},
        {Tag::Strong, {"strong", Type::Non_Self_Closing}},
        {Tag::Style, {"style", Type::Non_Self_Closing}},
        {Tag::Sub, {"sub", Type::Non_Self_Closing}},
        {Tag::Subscript, {"sub", Type::Non_Self_Closing}},
        {Tag::Sup, {"sup", Type::Non_Self_Closing}},
        {Tag::Superscript, {"sup", Type::Non_Self_Closing}},
        {Tag::Summary, {"summary", Type::Non_Self_Closing}},
        {Tag::Svg, {"svg", Type::Self_Closing}},
        {Tag::Table, {"table", Type::Non_Self_Closing}},
        {Tag::Tbody, {"tbody", Type::Non_Self_Closing}},
        {Tag::Td, {"td", Type::Non_Self_Closing}},
        {Tag::Template, {"template", Type::Non_Self_Closing}},
        {Tag::Tfoot, {"tfoot", Type::Non_Self_Closing}},
        {Tag::Th, {"th", Type::Non_Self_Closing}},
        {Tag::Tr, {"tr", Type::Non_Self_Closing}},
        {Tag::Thead, {"thead", Type::Non_Self_Closing}},
        {Tag::Time, {"time", Type::Non_Self_Closing}},
        {Tag::Title, {"title", Type::Non_Self_Closing}},
        {Tag::Track, {"track", Type::Self_Closing}},
        {Tag::Tt, {"tt", Type::Non_Self_Closing}},
        {Tag::Underline, {"u", Type::Non_Self_Closing}},
        {Tag::U, {"u", Type::Non_Self_Closing}},
        {Tag::Var, {"var", Type::Non_Self_Closing}},
        {Tag::Video, {"video", Type::Non_Self_Closing}},
        {Tag::Wbr, {"wbr", Type::Self_Closing}},
        {Tag::Xmp, {"xmp", Type::Non_Self_Closing}},
    };
}

bygg::string_type bygg::HTML::resolve_tag_enum_name(bygg::HTML::Tag tag) {
    static const std::unordered_map<Tag, std::string> tag_string_map = {
        {Tag::Empty, "Tag::Empty"},
        {Tag::Empty_No_Formatting, "Tag::Empty_No_Formatting"},
        {Tag::Abbreviation, "Tag::Abbreviation"},
        {Tag::Abbr, "Tag::Abbr"},
        {Tag::Acronym, "Tag::Acronym"},
        {Tag::Address, "Tag::Address"},
        {Tag::Applet, "Tag::Applet"},
        {Tag::Anchor, "Tag::Anchor"},
        {Tag::A, "Tag::A"},
        {Tag::Article, "Tag::Article"},
        {Tag::Area, "Tag::Area"},
        {Tag::Aside, "Tag::Aside"},
        {Tag::Audio, "Tag::Audio"},
        {Tag::Base, "Tag::Base"},
        {Tag::Basefont, "Tag::Basefont"},
        {Tag::Bdi, "Tag::Bdi"},
        {Tag::Bdo, "Tag::Bdo"},
        {Tag::Bgsound, "Tag::Bgsound"},
        {Tag::Big, "Tag::Big"},
        {Tag::Blockquote, "Tag::Blockquote"},
        {Tag::Body, "Tag::Body"},
        {Tag::B, "Tag::B"},
        {Tag::Bold, "Tag::Bold"},
        {Tag::Br, "Tag::Br"},
        {Tag::Break, "Tag::Break"},
        {Tag::Button, "Tag::Button"},
        {Tag::Caption, "Tag::Caption"},
        {Tag::Canvas, "Tag::Canvas"},
        {Tag::Center, "Tag::Center"},
        {Tag::Cite, "Tag::Cite"},
        {Tag::Code, "Tag::Code"},
        {Tag::Colgroup, "Tag::Colgroup"},
        {Tag::Column, "Tag::Column"},
        {Tag::Col, "Tag::Col"},
        {Tag::Data, "Tag::Data"},
        {Tag::Datalist, "Tag::Datalist"},
        {Tag::Dd, "Tag::Dd"},
        {Tag::Dfn, "Tag::Dfn"},
        {Tag::Define, "Tag::Define"},
        {Tag::Delete, "Tag::Delete"},
        {Tag::Del, "Tag::Del"},
        {Tag::Details, "Tag::Details"},
        {Tag::Dialog, "Tag::Dialog"},
        {Tag::Dir, "Tag::Dir"},
        {Tag::Div, "Tag::Div"},
        {Tag::Dl, "Tag::Dl"},
        {Tag::Dt, "Tag::Dt"},
        {Tag::Embed, "Tag::Embed"},
        {Tag::Emphasis, "Tag::Emphasis"},
        {Tag::Em, "Tag::Em"},
        {Tag::Fieldset, "Tag::Fieldset"},
        {Tag::Figcaption, "Tag::Figcaption"},
        {Tag::Figure, "Tag::Figure"},
        {Tag::Font, "Tag::Font"},
        {Tag::Footer, "Tag::Footer"},
        {Tag::Form, "Tag::Form"},
        {Tag::Frame, "Tag::Frame"},
        {Tag::Frameset, "Tag::Frameset"},
        {Tag::Head, "Tag::Head"},
        {Tag::Header, "Tag::Header"},
        {Tag::H1, "Tag::H1"},
        {Tag::H2, "Tag::H2"},
        {Tag::H3, "Tag::H3"},
        {Tag::H4, "Tag::H4"},
        {Tag::H5, "Tag::H5"},
        {Tag::H6, "Tag::H6"},
        {Tag::Hr, "Tag::Hr"},
        {Tag::Hgroup, "Tag::Hgroup"},
        {Tag::Html, "Tag::Html"},
        {Tag::Iframe, "Tag::Iframe"},
        {Tag::Image, "Tag::Image"},
        {Tag::Img, "Tag::Img"},
        {Tag::Input, "Tag::Input"},
        {Tag::Ins, "Tag::Ins"},
        {Tag::Isindex, "Tag::Isindex"},
        {Tag::Italic, "Tag::Italic"},
        {Tag::I, "Tag::I"},
        {Tag::Kbd, "Tag::Kbd"},
        {Tag::Keygen, "Tag::Keygen"},
        {Tag::Label, "Tag::Label"},
        {Tag::Legend, "Tag::Legend"},
        {Tag::List, "Tag::List"},
        {Tag::Li, "Tag::Li"},
        {Tag::Link, "Tag::Link"},
        {Tag::Main, "Tag::Main"},
        {Tag::Mark, "Tag::Mark"},
        {Tag::Marquee, "Tag::Marquee"},
        {Tag::Menuitem, "Tag::Menuitem"},
        {Tag::Meta, "Tag::Meta"},
        {Tag::Meter, "Tag::Meter"},
        {Tag::Nav, "Tag::Nav"},
        {Tag::Nobreak, "Tag::Nobreak"},
        {Tag::Nobr, "Tag::Nobr"},
        {Tag::Noembed, "Tag::Noembed"},
        {Tag::Noscript, "Tag::Noscript"},
        {Tag::Object, "Tag::Object"},
        {Tag::Optgroup, "Tag::Optgroup"},
        {Tag::Option, "Tag::Option"},
        {Tag::Output, "Tag::Output"},
        {Tag::Paragraph, "Tag::Paragraph"},
        {Tag::P, "Tag::P"},
        {Tag::Param, "Tag::Param"},
        {Tag::Phrase, "Tag::Phrase"},
        {Tag::Pre, "Tag::Pre"},
        {Tag::Progress, "Tag::Progress"},
        {Tag::Quote, "Tag::Quote"},
        {Tag::Q, "Tag::Q"},
        {Tag::Rp, "Tag::Rp"},
        {Tag::Rt, "Tag::Rt"},
        {Tag::Ruby, "Tag::Ruby"},
        {Tag::Outdated, "Tag::Outdated"},
        {Tag::S, "Tag::S"},
        {Tag::Sample, "Tag::Sample"},
        {Tag::Samp, "Tag::Samp"},
        {Tag::Script, "Tag::Script"},
        {Tag::Section, "Tag::Section"},
        {Tag::Small, "Tag::Small"},
        {Tag::Source, "Tag::Source"},
        {Tag::Spacer, "Tag::Spacer"},
        {Tag::Span, "Tag::Span"},
        {Tag::Strike, "Tag::Strike"},
        {Tag::Strong, "Tag::Strong"},
        {Tag::Style, "Tag::Style"},
        {Tag::Sub, "Tag::Sub"},
        {Tag::Subscript, "Tag::Subscript"},
        {Tag::Sup, "Tag::Sup"},
        {Tag::Superscript, "Tag::Superscript"},
        {Tag::Summary, "Tag::Summary"},
        {Tag::Svg, "Tag::Svg"},
        {Tag::Table, "Tag::Table"},
        {Tag::Tbody, "Tag::Tbody"},
        {Tag::Td, "Tag::Td"},
        {Tag::Template, "Tag::Template"},
        {Tag::Tfoot, "Tag::Tfoot"},
        {Tag::Th, "Tag::Th"},
        {Tag::Tr, "Tag::Tr"},
        {Tag::Thead, "Tag::Thead"},
        {Tag::Time, "Tag::Time"},
        {Tag::Title, "Tag::Title"},
        {Tag::Track, "Tag::Track"},
        {Tag::Tt, "Tag::Tt"},
        {Tag::Underline, "Tag::Underline"},
        {Tag::U, "Tag::U"},
        {Tag::Var, "Tag::Var"},
        {Tag::Video, "Tag::Video"},
        {Tag::Wbr, "Tag::Wbr"},
        {Tag::Xmp, "Tag::Xmp"},
    };

    if (tag_string_map.find(tag) != tag_string_map.end()) {
        return tag_string_map.at(tag);
    }

    throw bygg::invalid_argument{"Invalid tag"};
}

std::pair<bygg::string_type, bygg::HTML::Type> bygg::HTML::resolve_tag(const Tag tag) {
    const std::unordered_map<bygg::HTML::Tag, std::pair<bygg::string_type, bygg::HTML::Type>> tag_map{get_tag_map()};

    if (tag_map.find(tag) != tag_map.end()) {
        return tag_map.at(tag);
    }

    const string_type throwmsg{"Invalid tag: " + std::to_string(static_cast<bygg::integer_type>(tag))};
    throw invalid_argument{throwmsg.c_str()};
}

bygg::HTML::Tag bygg::HTML::resolve_tag(const bygg::string_type& tag) {
    const std::unordered_map<bygg::HTML::Tag, std::pair<bygg::string_type, bygg::HTML::Type>> tag_map{get_tag_map()};

    for (const auto& it : tag_map) {
        if (it.second.first == tag) {
            return it.first;
        }
    }

    throw invalid_argument{"Invalid tag"};
}

bool bygg::HTML::is_container(const string_type& tag) {
    static const std::vector<std::string> container_elements = {
        "div",
        "section",
        "article",
        "nav",
        "aside",
        "head",
        "header",
        "footer",
        "foot",
        "main",
        "ul",
        "ol",
        "li",
        "body",
        "table",
        "tbody",
        "thead",
        "tfoot",
        "tr",
        "td",
        "th",
        "form",
        "fieldset",
        "details",
        "summary",
        "html",
    };

    return std::find(container_elements.begin(), container_elements.end(), tag) != container_elements.end();
}

bool bygg::HTML::is_container(Tag tag) {
    return is_container(resolve_tag(tag).first);
}